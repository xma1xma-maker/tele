<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clicker Pro V6 - Mustafa Alaa</title>

    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Adsgram SDK -->
    <script src="https://adsgram.ai/sdk.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* ====== (CSS ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù) ====== */
        :root {
            --bg-dark: #0a0a0a;
            --primary: #0098EA;
            --secondary: #f39c12;
            --surface: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --success: #2ecc71;
            --danger: #e74c3c;
            --energy-color: #ffeb3b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a3a5a, #000);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 95px;
            overflow-x: hidden;
        }
        /* ====== Ø¨Ù‚ÙŠØ© CSS Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ====== */
    </style>
</head>

<body>

<div id="loader">
    <div style="width:50px;height:50px;border:5px solid #222;border-top-color:#0098EA;border-radius:50%;animation:spin 1s infinite linear"></div>
    <h3 style="margin-top:20px">Clicker Pro V6</h3>
</div>

<!-- ====== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙƒÙ…Ø§ Ù‡ÙŠ ====== -->

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyACixZDVCNww716fRN_29xm2kCnFadkL64",
        authDomain: "tele-ea6e7.firebaseapp.com",
        projectId: "tele-ea6e7",
        storageBucket: "tele-ea6e7.firebasestorage.app",
        messagingSenderId: "693110799024",
        appId: "1:693110799024:web:4dd4057eef17b9ed3e1975"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tg = window.Telegram.WebApp;
    tg.expand();

    let userId = "guest";

    /* ===============================
       Adsgram Integration (FULL)
       =============================== */

    const adsgram = new Adsgram({
        blockId: "int-22662"
    });

    // Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† Ù…ÙƒØ§ÙØ£Ø©
    window.showRewardAd = async () => {
        try {
            await adsgram.show();

            // Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø¨Ø¹Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
            state.score += 300;
            state.energy = Math.min(state.maxEnergy, state.energy + 50);

            updateUI();
            await syncPoints();

            tg.showAlert("ğŸ‰ ØªÙ… Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­ +300 Ù†Ù‚Ø·Ø© +50 Ø·Ø§Ù‚Ø©");
        } catch (e) {
            tg.showAlert("âŒ Ù„Ù… ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†");
        }
    };

    /* ===============================
       Game State
       =============================== */

    let state = {
        score: 0,
        lang: 'ar',
        energy: 1000,
        maxEnergy: 1000,
        lastDaily: 0,
        lastQuiz: 0,
        completedTasks: []
    };

    window.onload = async () => {
        if (tg.initDataUnsafe?.user) {
            userId = tg.initDataUnsafe.user.id.toString();
        }
        await loadUserData();
        updateUI();
        document.getElementById('loader').style.display = 'none';
    };

    async function loadUserData() {
        const ref = doc(db, "players", userId);
        const snap = await getDoc(ref);
        if (snap.exists()) {
            state = { ...state, ...snap.data() };
        } else {
            await setDoc(ref, state);
        }
    }

    async function syncPoints() {
        await setDoc(doc(db, "players", userId), state, { merge: true });
    }

    function updateUI() {
        document.getElementById('score')?.innerText = state.score.toLocaleString();
        document.getElementById('energy-val')?.innerText = state.energy;
    }

    /* ===============================
       Ù…Ø«Ø§Ù„ Ø²Ø± Ø¥Ø¹Ù„Ø§Ù†
       =============================== */
    window.watchAd = () => {
        showRewardAd();
    };

</script>

<!-- Ø²Ø± ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† -->
<button onclick="watchAd()" style="
    position:fixed;
    top:80px;
    left:20px;
    background:#f39c12;
    border:none;
    padding:12px 20px;
    border-radius:12px;
    font-weight:bold;
    z-index:9999;
">
ğŸ¬ Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ø±Ø¨Ø­
</button>

</body>
</html>

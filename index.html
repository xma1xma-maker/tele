<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Royal Clicker V13</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #1c1c1c;
            --gold: #ffd700;
            --blue: #0088cc;
            --red: #ff3b30;
            --green: #4cd964;
            --text: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text);
            margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
            background-image: radial-gradient(circle at 50% 10%, #2a2a2a, #000);
            transition: background 0.3s;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ø·Ø£ (Ø§Ù„Ø´Ø§Ø´Ø© Ø­Ù…Ø±Ø§Ø¡) */
        .shake-screen { animation: shake 0.5s; border: 2px solid var(--red); }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        /* --- Header --- */
        .header { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .lang-btn { background: rgba(255,255,255,0.1); color: #fff; padding: 5px 12px; border-radius: 20px; border: 1px solid #333; font-size: 0.8rem; }

        /* --- Score --- */
        .score-box { text-align: center; margin-top: 10px; }
        .score-val { font-size: 3.5rem; font-weight: 900; color: var(--gold); text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .score-sub { font-size: 0.9rem; color: #777; }

        /* --- Features --- */
        .feat-bar { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .feat-btn {
            background: linear-gradient(145deg, #222, #111); width: 60px; height: 60px;
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; border: 1px solid #333; box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            transition: transform 0.1s; cursor: pointer;
        }
        .feat-btn:active { transform: scale(0.9); }

        /* --- Main Coin --- */
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .coin {
            width: 240px; height: 240px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #0088cc, #005580);
            border: 6px solid #00aaff;
            box-shadow: 0 0 40px rgba(0, 136, 204, 0.4), inset 0 10px 20px rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center;
            font-size: 5rem; color: #fff; font-weight: bold; cursor: pointer;
            position: relative; transition: transform 0.08s;
        }
        .coin:active { transform: scale(0.95); }
        .coin img { width: 60%; opacity: 0.9; } /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© */

        /* --- Footer --- */
        .energy-cont { margin: 0 20px 20px; background: #151515; padding: 12px; border-radius: 15px; border: 1px solid #333; }
        .bar-bg { background: #000; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; width: 100%; background: linear-gradient(90deg, var(--gold), var(--red)); transition: width 0.3s; }

        .nav { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 10px 20px 30px; padding-bottom: calc(20px + env(safe-area-inset-bottom)); }
        .nav-btn {
            background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px solid #333;
            color: #fff; font-weight: bold; font-size: 0.9rem; display: flex; flex-direction: column; align-items: center;
        }

        /* --- Modals --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: flex; align-items: flex-end; justify-content: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-card {
            background: #181818; width: 100%; max-width: 500px;
            border-radius: 25px 25px 0 0; padding: 30px 20px;
            border-top: 2px solid var(--gold); transform: translateY(100%); transition: 0.3s;
            max-height: 90vh; overflow-y: auto; text-align: center;
        }
        .modal.active .modal-card { transform: translateY(0); }

        /* --- Lucky Wheel (ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø²ÙŠÙ†Ùˆ) --- */
        .wheel-wrapper { position: relative; width: 250px; height: 250px; margin: 20px auto; }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%;
            border: 8px solid var(--gold);
            background: conic-gradient(
                #ff3b30 0deg 60deg,
                #1c1c1c 60deg 120deg,
                #0088cc 120deg 180deg,
                #ffd700 180deg 240deg,
                #4cd964 240deg 300deg,
                #1c1c1c 300deg 360deg
            );
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1);
            position: relative;
        }
        /* Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ø­ÙˆÙ„ Ø§Ù„Ø¹Ø¬Ù„Ø© */
        .wheel::after {
            content: ''; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%; border: 2px dashed rgba(255,255,255,0.5);
        }
        .pointer {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #fff;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5)); z-index: 10;
        }
        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; background: var(--gold); border-radius: 50%;
            box-shadow: 0 0 10px #000; z-index: 5;
        }

        /* --- Daily Reward --- */
        .days-grid { display: flex; gap: 5px; justify-content: center; margin: 20px 0; }
        .day-item { background: #333; padding: 10px; border-radius: 8px; font-size: 0.8rem; width: 45px; opacity: 0.5; }
        .day-item.checked { background: var(--green); opacity: 1; color: #000; font-weight: bold; }
        .day-item.today { border: 2px solid var(--gold); opacity: 1; }

        /* --- Elements --- */
        .btn { width: 100%; padding: 15px; background: var(--gold); color: #000; font-weight: 900; border-radius: 12px; border: none; margin-top: 15px; font-size: 1rem; cursor: pointer; }
        .btn-close { background: #333; color: #fff; margin-top: 10px; }
        .inp { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 10px; text-align: center; }

    </style>
</head>
<body>

    <div class="header">
        <div class="lang-btn">V13 Royal</div>
        <div class="lang-btn" id="user-id">ID: ...</div>
    </div>

    <div class="score-box">
        <div class="score-val" id="score">0</div>
        <div class="score-sub">TON Coins</div>
    </div>

    <div class="feat-bar">
        <div class="feat-btn" onclick="openDaily()">ğŸ“…</div>
        <div class="feat-btn" onclick="openWheel()">ğŸ¡</div>
        <div class="feat-btn" onclick="openModal('codes')">ğŸ</div>
    </div>

    <div class="game-area">
        <div class="coin" onclick="tap(event)">
            <svg width="100" height="100" viewBox="0 0 24 24" fill="white"><path d="M12 22L1.5 8 12 2l10.5 6L12 22zm0-2.5l8-10-8-5.5-8 5.5 8 10z"/></svg>
        </div>
    </div>

    <div class="energy-cont">
        <div style="display:flex; justify-content:space-between; font-size:0.9rem">
            <span>âš¡ Energy</span>
            <span id="energy-txt">100/100</span>
        </div>
        <div class="bar-bg"><div class="bar-fill" id="energy-bar"></div></div>
    </div>

    <div class="nav">
        <div class="nav-btn" onclick="openModal('shop')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</div>
        <div class="nav-btn" onclick="openModal('tasks')">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
        <div class="nav-btn" onclick="startQuiz()">â“ Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
    </div>


    <div class="modal" id="daily">
        <div class="modal-card">
            <h2>ğŸ“… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
            <p>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„ØªØ±Ø¨Ø­ Ø§Ù„Ù…Ø²ÙŠØ¯!</p>
            
            <div class="days-grid" id="days-container">
                <div class="day-item">1</div>
                <div class="day-item">2</div>
                <div class="day-item">3</div>
                <div class="day-item">4</div>
                <div class="day-item">5</div>
                <div class="day-item">6</div>
                <div class="day-item">7</div>
            </div>

            <h3 id="daily-status" style="color:var(--gold)">...</h3>
            
            <button class="btn" id="claim-btn" onclick="claimDailyReward()">Ø§Ø³ØªÙ„Ø§Ù… (+500)</button>
            <button class="btn btn-close" onclick="closeModal('daily')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div class="modal" id="wheel">
        <div class="modal-card">
            <h2>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h2>
            <p style="color:#888; margin-bottom:10px">ØªÙƒÙ„ÙØ© Ø§Ù„ØªØ¯ÙˆÙŠØ±: 100 Ù†Ù‚Ø·Ø©</p>
            
            <div class="wheel-wrapper">
                <div class="pointer"></div>
                <div class="wheel" id="wheel-spinner"></div>
                <div class="wheel-center"></div>
            </div>

            <button class="btn" id="spin-btn" onclick="spin()">ØªØ¯ÙˆÙŠØ± (-100)</button>
            <button class="btn btn-close" onclick="closeModal('wheel')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div class="modal" id="quiz">
        <div class="modal-card">
            <h2>â“ Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
            <div style="background:#222; padding:20px; border-radius:15px; margin:20px 0;">
                <h3 id="q-txt" style="margin-bottom:20px">...</h3>
                <div id="q-opts"></div>
            </div>
            <button class="btn btn-close" onclick="closeModal('quiz')">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
        </div>
    </div>

    <div class="modal" id="shop">
        <div class="modal-card">
            <h2>ğŸ›’ Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</h2>
            <input id="link" class="inp" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø© (@channel)">
            <input id="count" type="number" class="inp" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" oninput="calcPrice()">
            <div style="margin:15px 0">Ø§Ù„Ø³Ø¹Ø±: <span id="price" style="color:var(--gold)">0</span></div>
            <button class="btn" onclick="buy()">Ø´Ø±Ø§Ø¡</button>
            <button class="btn btn-close" onclick="closeModal('shop')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <div class="modal" id="tasks">
        <div class="modal-card">
            <h2>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
            <div id="tasks-list" style="text-align:right"></div>
            <button class="btn btn-close" onclick="closeModal('tasks')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div class="modal" id="codes">
        <div class="modal-card">
            <h2>ğŸ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©</h2>
            <input id="promo" class="inp" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§">
            <button class="btn" onclick="redeem()">ØªØ­Ù‚Ù‚</button>
            <button class="btn btn-close" onclick="closeModal('codes')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // === Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
        const BOT_TOKEN = "8207071306:AAFqIFqsANxB7srrBEsUfZJkb4xzhsY5FMQ";
        const ADMIN_ID = "1759629479";

        // === Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
        const QUIZ = [
            { q: "Ù…Ø§ Ù‡Ùˆ Ø±Ù…Ø² Ø¹Ù…Ù„Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…ØŸ", ans: ["TON", "BTC", "USDT"], c: 0 },
            { q: "Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¹Ø±Ø§Ù‚ØŸ", ans: ["Ø§Ù„Ø¨ØµØ±Ø©", "Ø¨ØºØ¯Ø§Ø¯", "Ø§Ù„Ù…ÙˆØµÙ„"], c: 1 },
            { q: "ÙƒÙ… Ù„ÙˆÙ† ÙÙŠ Ø¹Ù„Ù… Ù…ØµØ±ØŸ", ans: ["2", "4", "3"], c: 2 },
            { q: "Ø£Ø³Ø±Ø¹ Ø­ÙŠÙˆØ§Ù† Ø¨Ø±ÙŠØŸ", ans: ["Ø§Ù„ÙÙ‡Ø¯", "Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„Ø­ØµØ§Ù†"], c: 0 }
        ];

        const TASKS = [
            { id: 1, title: "Ø§Ù†Ø¶Ù… Ù„Ù‚Ù†Ø§ØªÙ†Ø§", url: "https://t.me/YOUR_CH", r: 200 },
            { id: 2, title: "ØªØ§Ø¨Ø¹Ù†Ø§ Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…", url: "https://instagram.com", r: 150 }
        ];

        // === Ø§Ù„Ù…Ø­Ø±Ùƒ ===
        const tg = window.Telegram.WebApp; tg.expand();
        let score = parseInt(localStorage.getItem('score_v13') || 0);
        let energy = 100;
        let doneTasks = JSON.parse(localStorage.getItem('done_tasks') || "[]");
        
        // ØªØ´ØºÙŠÙ„
        updateUI();
        setInterval(() => { if(energy<100) { energy++; updateUI(); } }, 2000);

        // --- 1. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ---
        function openDaily() {
            openModal('daily');
            const lastDate = localStorage.getItem('last_daily_date');
            const today = new Date().toDateString(); // ÙŠØ¹Ø·ÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø§Ù„ÙˆÙ‚Øª (Ù…Ø«Ù„Ø§Ù‹: Mon Feb 03 2026)
            let streak = parseInt(localStorage.getItem('streak') || 1);

            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£ÙŠØ§Ù…
            const days = document.querySelectorAll('.day-item');
            days.forEach((d, i) => {
                d.className = 'day-item'; // reset
                if (i < streak) d.classList.add('checked');
                if (i === streak - 1) d.classList.add('today');
            });

            const btn = document.getElementById('claim-btn');
            const status = document.getElementById('daily-status');

            if (lastDate === today) {
                // Ø¥Ø°Ø§ Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙŠÙˆÙ…
                btn.disabled = true;
                btn.innerText = "Ø¹Ø¯ ØºØ¯Ø§Ù‹ â³";
                btn.style.background = "#555";
                status.innerText = "Ù„Ù‚Ø¯ Ø§Ø³ØªÙ„Ù…Øª Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙŠÙˆÙ… âœ…";
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ³ØªÙ„Ù…
                btn.disabled = false;
                btn.innerText = `Ø§Ø³ØªÙ„Ø§Ù… (+${streak * 100})`;
                btn.style.background = "var(--gold)";
                status.innerText = `Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙŠÙˆÙ… ${streak}`;
            }
        }

        function claimDailyReward() {
            const today = new Date().toDateString();
            let streak = parseInt(localStorage.getItem('streak') || 1);
            
            score += streak * 100;
            localStorage.setItem('last_daily_date', today);
            
            // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³ØªØ±ÙŠÙƒ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 7)
            if(streak < 7) streak++; else streak = 1;
            localStorage.setItem('streak', streak);

            save(); updateUI(); openDaily(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            tg.showAlert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©!");
        }

        // --- 2. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© (Ù…Ø¹ Ø§Ù„Ø®ØµÙ…) ---
        function startQuiz() {
            openModal('quiz');
            const q = QUIZ[Math.floor(Math.random() * QUIZ.length)];
            document.getElementById('q-txt').innerText = q.q;
            const opts = document.getElementById('q-opts');
            opts.innerHTML = '';
            
            q.ans.forEach((a, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.background = '#333';
                btn.style.marginTop = '10px';
                btn.innerText = a;
                btn.onclick = () => checkAns(i, q.c);
                opts.appendChild(btn);
            });
        }

        function checkAns(selected, correct) {
            if (selected === correct) {
                // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                score += 100;
                tg.showAlert("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +100");
                closeModal('quiz');
            } else {
                // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© (Ø®ØµÙ…)
                if(score >= 50) score -= 50; else score = 0; // Ù„Ø§ Ù†Ù†Ø²Ù„ ØªØ­Øª Ø§Ù„ØµÙØ±
                
                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø£Ø­Ù…Ø±
                document.body.classList.add('shake-screen');
                setTimeout(() => document.body.classList.remove('shake-screen'), 500);
                
                tg.showAlert("Ø®Ø·Ø£! ØªÙ… Ø®ØµÙ… 50 Ù†Ù‚Ø·Ø© âŒ");
            }
            save(); updateUI();
        }

        // --- 3. Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
        function openWheel() { openModal('wheel'); }
        
        function spin() {
            if (score < 100) return tg.showAlert("ØªØ­ØªØ§Ø¬ 100 Ù†Ù‚Ø·Ø©!");
            score -= 100; save(); updateUI();
            
            const wheel = document.getElementById('wheel-spinner');
            const deg = Math.floor(3000 + Math.random() * 3000); // Ø¯ÙˆØ±Ø§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù‚ÙˆÙŠ
            wheel.style.transform = `rotate(${deg}deg)`;
            
            document.getElementById('spin-btn').disabled = true;

            setTimeout(() => {
                // Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² (Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªÙˆÙ‚Ù Ù„Ù„ØªØ¨Ø³ÙŠØ·)
                const prizes = [0, 50, 200, 500, 1000, 0]; 
                const win = prizes[Math.floor(Math.random() * prizes.length)];
                
                score += win; save(); updateUI();
                
                if(win > 0) tg.showAlert(`Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${win} Ù†Ù‚Ø·Ø© ğŸ‰`);
                else tg.showAlert("Ø­Ø¸ Ø£ÙˆÙØ±! ğŸ˜¢");
                
                document.getElementById('spin-btn').disabled = false;
            }, 4000);
        }

        // --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ---
        function tap(e) { 
            if(energy>0){ score++; energy--; save(); updateUI(); floatNum(e.clientX, e.clientY); if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium'); }
        }
        function save() { localStorage.setItem('score_v13', score); }
        function updateUI() { 
            document.getElementById('score').innerText = score.toLocaleString();
            document.getElementById('energy-txt').innerText = `${energy}/100`;
            document.getElementById('energy-bar').style.width = energy + '%';
        }
        function openModal(id) { document.getElementById(id).classList.add('active'); if(id==='tasks') loadTasks(); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        function floatNum(x, y) {
            const el = document.createElement('div'); el.innerText = '+1';
            el.style.cssText = `position:fixed; left:${x}px; top:${y}px; color:#fff; font-weight:bold; pointer-events:none; animation:fly 0.8s forwards; z-index:999; text-shadow:0 0 5px gold;`;
            document.body.appendChild(el); setTimeout(()=>el.remove(), 800);
        }
        document.head.insertAdjacentHTML("beforeend", `<style>@keyframes fly {to{transform:translateY(-80px);opacity:0}}</style>`);

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ù…Ù‡Ø§Ù… ---
        function calcPrice() { document.getElementById('price').innerText = (document.getElementById('count').value * 4); }
        function buy() {
            const l=document.getElementById('link').value, c=document.getElementById('count').value, p=c*4;
            if(score<p) return tg.showAlert("Ù†Ù‚Ø§Ø·Ùƒ Ù„Ø§ ØªÙƒÙÙŠ");
            score-=p; save(); updateUI();
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=NewOrder%0A${l}%0A${c}`);
            tg.showAlert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!"); closeModal('shop');
        }
        function loadTasks() {
            const l = document.getElementById('tasks-list'); l.innerHTML = '';
            TASKS.filter(t => !doneTasks.includes(t.id)).forEach(t => {
                l.innerHTML += `<div style="background:#333; padding:10px; margin-bottom:5px; border-radius:10px; display:flex; justify-content:space-between; align-items:center"><span>${t.title}</span><button onclick="doTask(${t.id},'${t.url}',${t.r})" style="background:var(--gold); border:none; padding:5px 10px; border-radius:5px; cursor:pointer">ØªÙ†ÙÙŠØ° +${t.r}</button></div>`;
            });
        }
        function doTask(id, url, r) {
            window.open(url); tg.showConfirm("Ù‡Ù„ Ø§Ø´ØªØ±ÙƒØªØŸ", (ok)=>{ if(ok){score+=r; doneTasks.push(id); localStorage.setItem('done_tasks', JSON.stringify(doneTasks)); save(); updateUI(); loadTasks();} });
        }
        function redeem() {
            if(document.getElementById('promo').value === "TON2025") { score+=1000; save(); updateUI(); closeModal('codes'); tg.showAlert("+1000!"); }
            else tg.showAlert("ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦");
        }

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        .packet-animation:active { transform: scale(0.9 ); }
        .gradient-bg { background: linear-gradient(180deg, #020617 0%, #0f172a 100%); }
        .nav-active { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .hidden { display: none; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-100 pb-28">

    <div id="loading-screen" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center"><div class="text-center"><div class="w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div><p id="loading-text" class="font-bold text-amber-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</p></div></div>
    <header class="p-4 max-w-md mx-auto flex justify-between items-center mt-2"><div class="bg-slate-900 rounded-2xl px-5 py-2 border border-green-500/20 shadow-xl flex flex-col items-center"><span class="text-[10px] text-slate-400 font-bold">Ø§Ù„Ø±ØµÙŠØ¯</span><span id="balance-display" class="font-black text-green-500 text-lg">0.00$</span></div><div class="bg-slate-900 rounded-2xl px-5 py-2 border border-blue-500/20 shadow-xl flex flex-col items-center"><span class="text-[10px] text-slate-400 font-bold">Ø§Ù„Ù…Ø¤Ù‚Øª</span><span id="timer-display" class="font-black text-blue-400 text-lg">Ù…ØªØ§Ø­</span></div></header>
    
    <main id="section-home" class="max-w-md mx-auto flex flex-col items-center p-4">
        <img src="https://i.ibb.co/3yxmRCHd/1000124039.jpg" class="w-24 h-24 rounded-full border-4 border-amber-500 shadow-2xl mb-4" alt="Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„">
        <h1 class="text-2xl font-black text-amber-500 mb-1">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„</h1>
        <p class="text-[10px] text-slate-400 mb-10 text-center">Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø³Ù†ØªØ§Øª</p>
        <div id="open-packet-btn" class="cursor-pointer transition-all duration-300 packet-animation hover:scale-105"><div class="w-40 h-52 bg-gradient-to-b from-amber-800 to-amber-950 border-4 border-amber-500 rounded-[2.5rem] flex flex-col items-center justify-center shadow-2xl relative"><div class="absolute top-0 w-full h-8 bg-amber-700/30 rounded-t-[2.1rem]"></div><span class="text-4xl font-black text-amber-500">Ø¬Ø¨Ø³</span></div></div>
        <button id="main-action-btn" class="mt-10 w-full bg-amber-500 text-slate-950 py-4 rounded-2xl font-black text-xl shadow-lg active:scale-95 transition-all">Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø¢Ù†</button>
        <button id="rewarded-ad-btn" class="mt-4 w-full bg-blue-600 text-white py-3 rounded-2xl font-bold text-base shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2"></button>
    </main>

    <section id="section-tasks" class="max-w-md mx-auto p-4 hidden"><h2 class="text-2xl font-black mb-6 text-center text-amber-500">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ù‡Ø§Ù…</h2><div id="tasks-container" class="space-y-4"></div></section>
    <section id="section-store" class="max-w-md mx-auto p-4 hidden"><h2 class="text-2xl font-black mb-2 text-center text-green-500">Ø·Ù„Ø¨ Ø³Ø­Ø¨</h2><p class="text-center text-xs text-slate-400 mb-8 font-bold">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: 500.00$</p><div id="store-container" class="space-y-4"></div></section>
    <div id="prize-modal" class="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-6 hidden"><div class="bg-slate-900 border-2 border-amber-500 p-10 rounded-[3rem] text-center max-w-xs w-full shadow-2xl"><div id="modal-icon" class="text-7xl mb-6">ğŸª™</div><h2 id="modal-status" class="text-xl font-black text-white mb-2">Ù…Ø¨Ø±ÙˆÙƒ!</h2><p id="modal-prize-name" class="text-4xl font-black text-amber-500 mb-8">0.05$</p><button onclick="closeModal( )" class="w-full bg-amber-500 text-black py-4 rounded-2xl font-black">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button></div></div>
    <nav class="fixed bottom-6 left-6 right-6 bg-slate-900/90 backdrop-blur-xl border border-white/10 rounded-[2.5rem] p-2 flex justify-around shadow-2xl z-50"><button onclick="showSection('home')" id="nav-home" class="flex flex-col items-center p-3 rounded-2xl nav-active transition-all"><span class="text-xl">ğŸ </span><span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button><button onclick="showSection('tasks')" id="nav-tasks" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all"><span class="text-xl">ğŸ“‹</span><span class="text-[10px] font-bold">Ø§Ù„Ù…Ù‡Ø§Ù…</span></button><button onclick="showSection('store')" id="nav-store" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all"><span class="text-xl">ğŸ’µ</span><span class="text-[10px] font-bold">Ø§Ù„Ø³Ø­Ø¨</span></button></nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyD6Jdy-USR8Iy6qvFRGpVQY5qIjSxa-Fc0",
          authDomain: "salm-3521d.firebaseapp.com",
          projectId: "salm-3521d",
          storageBucket: "salm-3521d.appspot.com",
          messagingSenderId: "897813694871",
          appId: "1:897813694871:web:89c989960a8d620c4d1cd2"
        };

        try {
            const app = initializeApp(firebaseConfig );
            const auth = getAuth(app);
            const db = getFirestore(app);
            runApp(auth, db);
        } catch (error) {
            console.error("Initialization Error:", error);
            document.getElementById('loading-text').innerText = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
        }

        function runApp(auth, db) {
            const AdController = window.Adsgram.init({ blockId: "int-22662" });
            
            const showInterstitialAd = () => {
                return new Promise((resolve) => {
                    AdController.show().finally(() => resolve());
                });
            };

            let currentUser = null;
            let userData = { balance: 0, lastOpenTime: 0, completedTasks: [], rewardedAdCount: 0, lastRewardedAdTime: 0 };
            let appSettings = { tasks: [], prizes: [] };
            
            const COOLDOWN = 10 * 60 * 1000;
            const REWARDED_AD_BONUS = 0.20;
            const REWARDED_AD_LIMIT = 5;
            const REWARDED_AD_COOLDOWN = 10 * 60 * 1000;
            const MIN_WITHDRAW = 500.00;
            const STORE = [{ id: 'asia', name: 'Ø±ØµÙŠØ¯ Ø¢Ø³ÙŠØ§ Ø³ÙŠÙ„', price: 500, icon: 'ğŸ“²' }, { id: 'zain', name: 'Ø±ØµÙŠØ¯ Ø²ÙŠÙ† Ø§Ù„Ø¹Ø±Ø§Ù‚', price: 500, icon: 'ğŸ“±' }];

            async function syncRemoteData(dataToSync) {
                if (!currentUser) return;
                await setDoc(doc(db, "users", currentUser.uid), dataToSync, { merge: true });
            }

            window.showSection = async (name) => {
                await showInterstitialAd();
                document.querySelectorAll('main, section').forEach(s => s.classList.add('hidden'));
                document.getElementById(`section-${name}`).classList.remove('hidden');
                document.querySelectorAll('nav button').forEach(b => { b.classList.remove('nav-active', 'text-slate-500'); b.id === `nav-${name}` ? b.classList.add('nav-active') : b.classList.add('text-slate-500'); });
            };
            
            window.closeModal = async () => {
                await showInterstitialAd();
                document.getElementById('prize-modal').classList.add('hidden');
            };

            window.handleOpen = async () => {
                await showInterstitialAd();
                
                if (Date.now() - userData.lastOpenTime < COOLDOWN) return;
                if (appSettings.prizes.length === 0) { alert("ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø§Øª."); return; }
                
                const prize = appSettings.prizes[Math.floor(Math.random() * appSettings.prizes.length)];
                userData.balance += prize.val;
                userData.lastOpenTime = Date.now();
                
                await syncRemoteData({ balance: userData.balance, lastOpenTime: userData.lastOpenTime });
                updateUI();
                showModal(prize);
            };

            window.doTask = async (id, bonus, url) => {
                await showInterstitialAd();
                if (userData.completedTasks?.includes(id)) return;
                window.open(url, '_blank');
                userData.balance += bonus;
                if (!userData.completedTasks) userData.completedTasks = [];
                userData.completedTasks.push(id);
                await syncRemoteData({ balance: userData.balance, completedTasks: userData.completedTasks });
                updateUI();
            };

            window.requestWithdraw = async (price, name) => {
                await showInterstitialAd();
                if (userData.balance < MIN_WITHDRAW) { alert(`Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ${userData.balance.toFixed(2)}$ØŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ ${MIN_WITHDRAW}$`); return; }
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø³Ø­Ø¨ ${price}$ØŸ`)) {
                    userData.balance -= price;
                    await syncRemoteData({ balance: userData.balance });
                    updateUI();
                    alert('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ùƒ!');
                    window.open(`https://t.me/your_user?text=Ø·Ù„Ø¨ Ø³Ø­Ø¨: ${name} Ù…Ù† ID: ${currentUser.uid}` );
                }
            };

            window.handleWatchAd = () => {
                const adButton = document.getElementById('rewarded-ad-btn');
                adButton.disabled = true;
                adButton.innerText = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†...';

                AdController.show().then(async (result) => {
                    if (result.done) {
                        userData.balance += REWARDED_AD_BONUS;
                        userData.rewardedAdCount++;
                        let dataToSync = { balance: userData.balance, rewardedAdCount: userData.rewardedAdCount };
                        if (userData.rewardedAdCount >= REWARDED_AD_LIMIT) {
                            userData.lastRewardedAdTime = Date.now();
                            dataToSync.lastRewardedAdTime = userData.lastRewardedAdTime;
                        }
                        await syncRemoteData(dataToSync);
                        alert(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${REWARDED_AD_BONUS.toFixed(2)}$`);
                    } else {
                        alert("ÙŠØ¬Ø¨ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©.");
                    }
                }).catch(() => {
                    alert("Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                }).finally(() => {
                    updateUI();
                });
            };

            function updateAdButtonState() {
                const adButton = document.getElementById('rewarded-ad-btn');
                const now = Date.now();
                const timeSinceLastCycle = now - (userData.lastRewardedAdTime || 0);

                if (userData.rewardedAdCount >= REWARDED_AD_LIMIT && timeSinceLastCycle < REWARDED_AD_COOLDOWN) {
                    const remaining = REWARDED_AD_COOLDOWN - timeSinceLastCycle;
                    const mins = Math.floor(remaining / 60000);
                    const secs = Math.floor((remaining % 60000) / 1000);
                    const timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                    adButton.disabled = true;
                    adButton.innerHTML = `<span>Ø§Ù†ØªØ¸Ø± ${timeStr} Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹</span>`;
                } else {
                    if (userData.rewardedAdCount >= REWARDED_AD_LIMIT) {
                        userData.rewardedAdCount = 0;
                        syncRemoteData({ rewardedAdCount: 0 });
                    }
                    adButton.disabled = false;
                    const remainingViews = REWARDED_AD_LIMIT - (userData.rewardedAdCount || 0);
                    adButton.innerHTML = `<span class="text-xl">ğŸ“º</span> <span>Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† (${remainingViews}/${REWARDED_AD_LIMIT}) ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ ${REWARDED_AD_BONUS.toFixed(2)}$</span>`;
                }
            }
            
            function updateUI() {
                document.getElementById('balance-display').innerText = `${(userData.balance || 0).toFixed(2)}$`;
                updateAdButtonState();
                checkTimer();
                renderTasks();
                renderStore();
            }

            function showModal(prize) { document.getElementById('modal-icon').innerText = prize.icon; document.getElementById('modal-status').innerText = prize.val > 0 ? "Ù…Ø¨Ø±ÙˆÙƒ!" : "ÙŠØ§ Ù„Ù„Ø£Ø³Ù!"; document.getElementById('modal-prize-name').innerText = prize.name; document.getElementById('prize-modal').classList.remove('hidden'); }
            function checkTimer() { const now = Date.now(), diff = now - (userData.lastOpenTime || 0), remaining = Math.max(0, COOLDOWN - diff), btn = document.getElementById('main-action-btn'), packet = document.getElementById('open-packet-btn'); if (remaining > 0) { const mins = Math.floor(remaining / 60000), secs = Math.floor((remaining % 60000) / 1000), timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`; document.getElementById('timer-display').innerText = timeStr; document.getElementById('timer-display').className = "font-black text-red-400 text-lg"; btn.innerText = `Ø§Ù†ØªØ¸Ø± ${timeStr}`; btn.disabled = true; packet.style.opacity = "0.4"; } else { document.getElementById('timer-display').innerText = "Ù…ØªØ§Ø­"; document.getElementById('timer-display').className = "font-black text-green-400 text-lg"; btn.innerText = "Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø¢Ù†"; btn.disabled = false; packet.style.opacity = "1"; } }
            function renderTasks() { const container = document.getElementById('tasks-container'); if (!appSettings.tasks) return; container.innerHTML = appSettings.tasks.map(t => { const done = userData.completedTasks?.includes(t.id); return `<div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 flex justify-between items-center shadow-lg"><div class="flex items-center gap-4"><span class="text-3xl">${t.icon}</span><div><p class="font-bold text-sm">${t.name}</p><p class="text-xs text-green-500 font-bold">+${t.bonus.toFixed(2)}$</p></div></div><button onclick="doTask('${t.id}', ${t.bonus}, '${t.url}')" ${done ? 'disabled' : ''} class="px-5 py-2 rounded-xl text-[10px] font-black ${done ? 'bg-green-500/20 text-green-500' : 'bg-white text-black'}">${done ? 'ØªÙ…' : 'ØªÙ†ÙÙŠØ°'}</button></div>`; }).join(''); }
            function renderStore() { const container = document.getElementById('store-container'); container.innerHTML = STORE.map(s => `<div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 flex justify-between items-center"><div class="flex items-center gap-3"><span class="text-3xl">${s.icon}</span><span class="font-bold text-sm">${s.name}</span></div><button onclick="requestWithdraw(${s.price}, '${s.name}')" class="bg-green-600 text-white px-5 py-2 rounded-xl text-[10px] font-black">${s.price.toFixed(2)}$</button></div>`).join(''); }

            async function initializeUserSession() {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        const userRef = doc(db, "users", user.uid);
                        const docSnap = await getDoc(userRef);

                        if (docSnap.exists()) {
                            const remoteData = docSnap.data();
                            userData = { ...userData, ...remoteData };
                        } else {
                            await syncRemoteData(userData);
                        }
                        
                        const settingsSnap = await getDoc(doc(db, "configs", "app-settings"));
                        if (settingsSnap.exists()) { appSettings = settingsSnap.data(); }
                        
                        document.getElementById('loading-screen').classList.add('hidden');
                        updateUI();
                        setInterval(checkTimer, 1000);
                        setInterval(updateAdButtonState, 1000);
                    } else {
                        signInAnonymously(auth);
                    }
                });
            }
            
            document.getElementById('open-packet-btn').onclick = () => window.handleOpen();
            document.getElementById('main-action-btn').onclick = () => window.handleOpen();
            document.getElementById('rewarded-ad-btn').onclick = () => window.handleWatchAd();

            initializeUserSession();
        }
    </script>
</body>
</html>

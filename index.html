<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Clicker V15</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --card: #151515;
            --ton: #0098EA;
            --gold: #FFD700;
            --text: #ffffff;
            --green: #4cd964;
            --red: #ff3b30;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text);
            margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #004080, #000);
            padding-bottom: 90px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖÿ´ÿ®ÿ™ÿ© */
        }

        /* Header */
        .header { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); }
        .lang-btn { background: transparent; border: 1px solid var(--ton); color: var(--ton); padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .id-badge { font-size: 0.8rem; color: #888; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 8px; }

        /* Score */
        .score-box { text-align: center; margin-top: 15px; }
        .score-val { font-size: 3.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px var(--ton); }
        .score-lbl { color: var(--ton); font-size: 0.9rem; margin-top: -5px; display: block; }

        /* Features (Daily & Codes only) */
        .feat-bar { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .feat-btn {
            background: #1a1a1a; width: 60px; height: 60px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
            cursor: pointer; border: 1px solid #333; transition: 0.2s;
        }
        .feat-btn:active { transform: scale(0.9); background: var(--ton); }

        /* Coin */
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .coin {
            width: 250px; height: 250px; border-radius: 50%;
            background: var(--ton); border: 8px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 60px rgba(0, 152, 234, 0.4);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.08s;
        }
        .coin:active { transform: scale(0.94); }
        .coin svg { width: 60%; fill: white; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }

        /* Energy */
        .energy-box { margin: 0 20px; background: #111; padding: 10px 15px; border-radius: 12px; border: 1px solid #333; }
        .bar-bg { background: #000; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #fff, var(--ton)); transition: width 0.3s; }

        /* Fixed Nav */
        .nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid #333;
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
            padding: 10px 15px; padding-bottom: calc(15px + env(safe-area-inset-bottom));
            z-index: 900;
        }
        .nav-btn {
            background: rgba(255,255,255,0.05); color: #fff; border: none;
            padding: 10px; border-radius: 10px; font-weight: bold; font-size: 0.9rem;
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
        }

        /* Modals */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 1000;
            display: flex; align-items: flex-end; justify-content: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-card {
            background: #181818; width: 100%; max-width: 500px;
            border-radius: 25px 25px 0 0; padding: 25px;
            border-top: 3px solid var(--ton); transform: translateY(100%); transition: 0.3s;
            max-height: 85vh; overflow-y: auto; text-align: center;
            padding-bottom: 50px;
        }
        .modal.active .modal-card { transform: translateY(0); }

        /* Elements */
        .btn { width: 100%; padding: 15px; background: var(--ton); color: #fff; border: none; border-radius: 12px; font-weight: bold; margin-top: 15px; font-size: 1rem; cursor: pointer; }
        .btn-close { background: #333; margin-top: 10px; }
        .inp { width: 100%; padding: 15px; background: #000; border: 1px solid #444; color: #fff; border-radius: 10px; margin-bottom: 10px; text-align: center; font-size: 1rem; }
        
        /* Quiz Styling */
        .quiz-opt { width: 100%; padding: 15px; background: #2a2a2a; border: 1px solid #444; color: #fff; margin-bottom: 10px; border-radius: 10px; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .quiz-opt:active { transform: scale(0.98); }
        .correct-anim { background: var(--green) !important; border-color: var(--green) !important; color: #000 !important; }
        .wrong-anim { background: var(--red) !important; border-color: var(--red) !important; }

        /* Tasks Styling */
        .task-row {
            background: #222; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #333;
        }
        .task-btn {
            background: var(--ton); border: none; color: #fff; padding: 5px 15px; border-radius: 6px; font-weight: bold; cursor: pointer;
        }

    </style>
</head>
<body>

    <div class="header">
        <button class="lang-btn" onclick="toggleLang()" id="lang-btn">üá∫üá∏ EN</button>
        <div class="id-badge" id="user-id">ID: ...</div>
    </div>

    <div class="score-box">
        <div class="score-val" id="score">0</div>
        <span class="score-lbl" data-key="score_title">TON Points</span>
    </div>

    <div class="feat-bar">
        <div class="feat-btn" onclick="openDaily()">üìÖ</div>
        <div class="feat-btn" onclick="openModal('codes')">üéÅ</div>
    </div>

    <div class="game-area">
        <div class="coin" onclick="tap(event)">
            <svg viewBox="0 0 24 24"><path d="M12 22L1.5 8 12 2l10.5 6L12 22zm0-2.5l8-10-8-5.5-8 5.5 8 10z"/></svg>
        </div>
    </div>

    <div class="energy-box">
        <div style="display:flex; justify-content:space-between; font-size:0.9rem">
            <span data-key="energy">Energy</span>
            <span id="energy-txt">100/100</span>
        </div>
        <div class="bar-bg"><div class="bar-fill" id="energy-bar"></div></div>
    </div>

    <div class="nav">
        <button class="nav-btn" onclick="openModal('shop')">üõí <span data-key="shop">Shop</span></button>
        <button class="nav-btn" onclick="openModal('tasks')">üìã <span data-key="tasks">Tasks</span></button>
        <button class="nav-btn" onclick="startQuiz()">‚ùì <span data-key="quiz">Quiz</span></button>
    </div>

    <div class="modal" id="quiz">
        <div class="modal-card">
            <h2 id="q-counter" style="color:#888; font-size:0.9rem; margin-bottom:5px">Question 1/5</h2>
            <h2 id="q-text" style="margin-top:0">...</h2>
            <div id="q-opts"></div>
            <button class="btn btn-close" onclick="closeModal('quiz')" data-key="close">Exit</button>
        </div>
    </div>

    <div class="modal" id="tasks">
        <div class="modal-card">
            <h2 data-key="tasks_title">Tasks</h2>
            <div id="task-list"></div>
            <button class="btn btn-close" onclick="closeModal('tasks')" data-key="close">Close</button>
        </div>
    </div>

    <div class="modal" id="daily">
        <div class="modal-card">
            <h2 data-key="daily_title">Daily Reward</h2>
            <p style="font-size:3rem; margin:20px">üìÖ</p>
            <p id="daily-msg" style="color:#aaa">...</p>
            <button class="btn" id="daily-claim-btn" onclick="claimDaily()">Claim</button>
            <button class="btn btn-close" onclick="closeModal('daily')" data-key="close">Close</button>
        </div>
    </div>

    <div class="modal" id="shop">
        <div class="modal-card">
            <h2 data-key="shop_title">Shop</h2>
            <input class="inp" id="shop-link" placeholder="@username">
            <input class="inp" type="number" id="shop-count" placeholder="Count">
            <button class="btn" onclick="buy()" data-key="buy">Buy</button>
            <button class="btn btn-close" onclick="closeModal('shop')" data-key="close">Close</button>
        </div>
    </div>

    <div class="modal" id="codes">
        <div class="modal-card">
            <h2>Promo Code</h2>
            <input class="inp" id="code-inp" placeholder="Code...">
            <button class="btn" onclick="redeem()">Redeem</button>
            <button class="btn btn-close" onclick="closeModal('codes')" data-key="close">Close</button>
        </div>
    </div>

    <script>
        // === Settings ===
        const BOT_TOKEN = "8207071306:AAFqIFqsANxB7srrBEsUfZJkb4xzhsY5FMQ";
        const ADMIN_ID = "1759629479";

        // === Quiz Questions ===
        const QUIZ_DATA = [
            { q_ar: "ŸÖÿß ŸáŸä ÿπŸÖŸÑÿ© ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖÿü", q_en: "Telegram coin?", ans: ["TON", "BTC", "SOL"], correct: 0 },
            { q_ar: "ŸÖÿß ÿπÿßÿµŸÖÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©ÿü", q_en: "Capital of KSA?", ans: ["ÿ¨ÿØÿ©", "ÿßŸÑÿ±Ÿäÿßÿ∂", "ŸÖŸÉÿ©"], correct: 1 },
            { q_ar: "ÿπŸÑŸÖ ÿßŸÑÿπÿ±ÿßŸÇ ŸÉŸÖ ŸÑŸàŸÜÿü", q_en: "Colors in Iraq flag?", ans: ["3", "4", "5"], correct: 1 },
            { q_ar: "ÿ£ŸÉÿ®ÿ± ÿØŸàŸÑÿ© ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü", q_en: "Biggest country?", ans: ["ÿßŸÑÿµŸäŸÜ", "ÿ±Ÿàÿ≥Ÿäÿß", "ŸÉŸÜÿØÿß"], correct: 1 },
            { q_ar: "ÿπÿØÿØ ÿ£ÿ±ŸÉÿßŸÜ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖÿü", q_en: "Pillars of Islam?", ans: ["4", "5", "6"], correct: 1 }
        ];

        // === Tasks List (Fixed) ===
        const TASKS = [
            { id: 101, t_ar: "ÿßÿ¥ÿ™ÿ±ŸÉ ŸÅŸä ŸÇŸÜÿßÿ™ŸÜÿß", t_en: "Join Channel", url: "https://t.me/telegram", r: 200 },
            { id: 102, t_ar: "ÿ™ÿßÿ®ÿπŸÜÿß ÿπŸÑŸâ ÿßŸÜÿ≥ÿ™ŸÇÿ±ÿßŸÖ", t_en: "Follow Instagram", url: "https://instagram.com", r: 150 },
            { id: 103, t_ar: "ÿ¥ÿßŸáÿØ ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ®", t_en: "Watch YouTube", url: "https://youtube.com", r: 300 }
        ];

        // === Translations ===
        const txt = {
            ar: { score_title: "ŸÜŸÇÿßÿ∑ ÿ™ŸàŸÜ", energy: "ÿßŸÑÿ∑ÿßŸÇÿ©", shop: "ÿßŸÑŸÖÿ™ÿ¨ÿ±", tasks: "ÿßŸÑŸÖŸáÿßŸÖ", quiz: "ŸÖÿ≥ÿßÿ®ŸÇÿ©", shop_title: "ÿ¥ÿ±ÿßÿ° ŸÖÿ™ÿßÿ®ÿπŸäŸÜ", tasks_title: "ÿßŸÑŸÖŸáÿßŸÖ", daily_title: "ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ© ÿßŸÑŸäŸàŸÖŸäÿ©", buy: "ÿ¥ÿ±ÿßÿ°", close: "ÿ•ÿ∫ŸÑÿßŸÇ" },
            en: { score_title: "TON Points", energy: "Energy", shop: "Shop", tasks: "Tasks", quiz: "Quiz", shop_title: "Buy Followers", tasks_title: "Tasks", daily_title: "Daily Reward", buy: "Buy", close: "Close" }
        };

        // === System ===
        const tg = window.Telegram.WebApp; tg.expand();
        let score = parseInt(localStorage.getItem('score_v15') || 0);
        let energy = 100;
        let lang = localStorage.getItem('lang') || 'ar';
        let doneTasks = JSON.parse(localStorage.getItem('done_tasks_v15') || "[]");

        // Quiz State
        let currentQuizIndex = 0;
        let isQuizAnswering = false;

        // Init
        document.getElementById('user-id').innerText = "ID: " + (tg.initDataUnsafe?.user?.id || "Unknown");
        applyLang(lang);
        updateUI();
        setInterval(() => { if(energy<100){energy++; updateUI();} }, 2000);

        function tap(e) {
            if(energy>0) { score++; energy--; save(); updateUI(); floatNum(e.clientX, e.clientY); if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light'); }
        }

        // --- NEW QUIZ SYSTEM (Continuous) ---
        function startQuiz() {
            currentQuizIndex = 0;
            openModal('quiz');
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuizIndex >= QUIZ_DATA.length) {
                // ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©
                tg.showAlert("ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©! üéâ");
                closeModal('quiz');
                return;
            }

            const q = QUIZ_DATA[currentQuizIndex];
            document.getElementById('q-counter').innerText = `Question ${currentQuizIndex + 1}/${QUIZ_DATA.length}`;
            document.getElementById('q-text').innerText = lang === 'ar' ? q.q_ar : q.q_en;
            
            const opts = document.getElementById('q-opts');
            opts.innerHTML = ''; // ŸÖÿ≥ÿ≠ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÇÿØŸäŸÖÿ©

            q.ans.forEach((ans, i) => {
                const btn = document.createElement('div');
                btn.className = 'quiz-opt';
                btn.innerText = ans;
                btn.onclick = () => handleAnswer(btn, i, q.correct);
                opts.appendChild(btn);
            });
            isQuizAnswering = false;
        }

        function handleAnswer(btn, selected, correct) {
            if (isQuizAnswering) return; // ŸÖŸÜÿπ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿßŸÑŸÖÿ™ŸÉÿ±ÿ±
            isQuizAnswering = true;

            if (selected === correct) {
                btn.classList.add('correct-anim');
                score += 50;
                tg.showAlert("Correct! +50");
            } else {
                btn.classList.add('wrong-anim');
                if(score >= 20) score -= 20;
                tg.showAlert("Wrong! -20");
            }
            save(); updateUI();

            // ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ´ÿßŸÜŸäÿ© ÿ´ŸÖ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä
            setTimeout(() => {
                currentQuizIndex++;
                loadQuestion();
            }, 1000);
        }

        // --- Tasks System (Fixed) ---
        function openTasksModal() {
            openModal('tasks');
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            
            const activeTasks = TASKS.filter(t => !doneTasks.includes(t.id));

            if(activeTasks.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#555">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ÿ≠ÿßŸÑŸäÿßŸã</div>';
                return;
            }

            activeTasks.forEach(t => {
                const title = lang === 'ar' ? t.t_ar : t.t_en;
                list.innerHTML += `
                <div class="task-row">
                    <div>
                        <div style="font-weight:bold">${title}</div>
                        <div style="font-size:0.8rem; color:var(--green)">+${t.r}</div>
                    </div>
                    <button class="task-btn" onclick="doTask(${t.id}, '${t.url}', ${t.r})">GO</button>
                </div>`;
            });
        }
        // ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑŸÖŸáÿßŸÖ ÿ®ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿµÿ≠ÿ≠ÿ©
        document.querySelector('button[onclick="openModal(\'tasks\')"]').onclick = openTasksModal;

        function doTask(id, url, r) {
            window.open(url);
            tg.showConfirm("Did you join?", (ok) => {
                if(ok) {
                    score += r;
                    doneTasks.push(id);
                    localStorage.setItem('done_tasks_v15', JSON.stringify(doneTasks));
                    save(); updateUI(); openTasksModal();
                }
            });
        }

        // --- Daily Reward (Fixed Logic) ---
        function openDaily() {
            openModal('daily');
            const lastDate = localStorage.getItem('last_daily_date');
            const today = new Date().toDateString(); // "Mon Feb 02 2026"
            const btn = document.getElementById('daily-claim-btn');
            const msg = document.getElementById('daily-msg');

            if (lastDate === today) {
                btn.disabled = true;
                btn.style.background = "#333";
                btn.innerText = lang === 'ar' ? "ÿπÿØ ÿ∫ÿØÿßŸã" : "Come back tomorrow";
                msg.innerText = "‚úÖ";
            } else {
                btn.disabled = false;
                btn.style.background = "var(--ton)";
                btn.innerText = lang === 'ar' ? "ÿßÿ≥ÿ™ŸÑÿßŸÖ (+500)" : "Claim (+500)";
                msg.innerText = "üéÅ";
            }
        }

        function claimDaily() {
            score += 500;
            localStorage.setItem('last_daily_date', new Date().toDateString());
            save(); updateUI(); openDaily();
            tg.showAlert("+500 Points!");
        }

        // --- Utils ---
        function toggleLang() { lang = lang==='ar'?'en':'ar'; localStorage.setItem('lang', lang); applyLang(lang); }
        function applyLang(l) {
            document.body.dir = l==='ar'?'rtl':'ltr'; document.getElementById('lang-btn').innerText = l==='ar'?'üá∫üá∏ EN':'üáÆüá∂ AR';
            document.querySelectorAll('[data-key]').forEach(el => { if(txt[l][el.getAttribute('data-key')]) el.innerText = txt[l][el.getAttribute('data-key')]; });
        }
        function save() { localStorage.setItem('score_v15', score); }
        function updateUI() { document.getElementById('score').innerText = score.toLocaleString(); document.getElementById('energy-txt').innerText = `${energy}/100`; document.getElementById('energy-bar').style.width = energy+'%'; }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function buy() {
            const l=document.getElementById('shop-link').value, c=document.getElementById('shop-count').value;
            if(score < c*4) return tg.showAlert("No Points");
            score -= c*4; save(); updateUI();
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=NewOrder%0A${l}%0A${c}`);
            tg.showAlert("Sent!"); closeModal('shop');
        }
        function redeem(){ if(document.getElementById('code-inp').value==="TON"){score+=1000;save();updateUI();tg.showAlert("+1000");closeModal('codes');} }
        function floatNum(x, y) { const el=document.createElement('div');el.innerText='+1';el.style.cssText=`position:fixed;left:${x}px;top:${y}px;color:#fff;font-weight:bold;pointer-events:none;z-index:999;animation:fly 0.8s forwards;`;document.body.appendChild(el);setTimeout(()=>el.remove(),800); }
        document.head.insertAdjacentHTML("beforeend", `<style>@keyframes fly {to{transform:translateY(-80px);opacity:0}}</style>`);

    </script>
</body>
</html>

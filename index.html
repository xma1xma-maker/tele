<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุณุงุจูุงุช ุณุงูู ุฏุนุจูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        .packet-animation:active { transform: scale(0.9 ); }
        .gradient-bg { background: linear-gradient(180deg, #020617 0%, #0f172a 100%); }
        .nav-active { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .hidden { display: none; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-100 pb-28">

    <div id="loading-screen" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center"><div class="text-center"><div class="w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div><p id="loading-text" class="font-bold text-amber-500">ุฌุงุฑู ุงูุงุชุตุงู...</p></div></div>
    <header class="p-4 max-w-md mx-auto flex justify-between items-center mt-2"><div class="bg-slate-900 rounded-2xl px-5 py-2 border border-green-500/20 shadow-xl flex flex-col items-center"><span class="text-[10px] text-slate-400 font-bold">ุงูุฑุตูุฏ</span><span id="balance-display" class="font-black text-green-500 text-lg">0.00$</span></div><div class="bg-slate-900 rounded-2xl px-5 py-2 border border-blue-500/20 shadow-xl flex flex-col items-center"><span class="text-[10px] text-slate-400 font-bold">ุงููุคูุช</span><span id="timer-display" class="font-black text-blue-400 text-lg">ูุชุงุญ</span></div></header>
    
    <main id="section-home" class="max-w-md mx-auto flex flex-col items-center p-4">
        <img src="https://i.ibb.co/3yxmRCHd/1000124039.jpg" class="w-24 h-24 rounded-full border-4 border-amber-500 shadow-2xl mb-4" alt="ุณุงูู ุฏุนุจูู">
        <h1 class="text-2xl font-black text-amber-500 mb-1">ูุณุงุจูุงุช ุณุงูู ุฏุนุจูู</h1>
        <p class="text-[10px] text-slate-400 mb-10 text-center">ุงูุชุญ ุงูููุณ ูู 10 ุฏูุงุฆู ูุงุฌูุน ุงูุณูุชุงุช</p>
        <div id="open-packet-btn" class="cursor-pointer transition-all duration-300 packet-animation hover:scale-105"><div class="w-40 h-52 bg-gradient-to-b from-amber-800 to-amber-950 border-4 border-amber-500 rounded-[2.5rem] flex flex-col items-center justify-center shadow-2xl relative"><div class="absolute top-0 w-full h-8 bg-amber-700/30 rounded-t-[2.1rem]"></div><span class="text-4xl font-black text-amber-500">ุฌุจุณ</span></div></div>
        <button id="main-action-btn" class="mt-10 w-full bg-amber-500 text-slate-950 py-4 rounded-2xl font-black text-xl shadow-lg active:scale-95 transition-all">ุงูุชุญ ุงูููุณ ุงูุขู</button>
        <button id="rewarded-ad-btn" class="mt-4 w-full bg-blue-600 text-white py-3 rounded-2xl font-bold text-base shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2"></button>
    </main>

    <section id="section-tasks" class="max-w-md mx-auto p-4 hidden"><h2 class="text-2xl font-black mb-6 text-center text-amber-500">ูุฑูุฒ ุงูููุงู</h2><div id="tasks-container" class="space-y-4"></div></section>
    <section id="section-store" class="max-w-md mx-auto p-4 hidden"><h2 class="text-2xl font-black mb-2 text-center text-green-500">ุทูุจ ุณุญุจ</h2><p class="text-center text-xs text-slate-400 mb-8 font-bold">ุงูุญุฏ ุงูุฃุฏูู ููุณุญุจ: 500.00$</p><div id="store-container" class="space-y-4"></div></section>
    <div id="prize-modal" class="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-6 hidden"><div class="bg-slate-900 border-2 border-amber-500 p-10 rounded-[3rem] text-center max-w-xs w-full shadow-2xl"><div id="modal-icon" class="text-7xl mb-6">๐ช</div><h2 id="modal-status" class="text-xl font-black text-white mb-2">ูุจุฑูู!</h2><p id="modal-prize-name" class="text-4xl font-black text-amber-500 mb-8">0.05$</p><button onclick="closeModal( )" class="w-full bg-amber-500 text-black py-4 rounded-2xl font-black">ุงุณุชูุฑุงุฑ</button></div></div>
    <nav class="fixed bottom-6 left-6 right-6 bg-slate-900/90 backdrop-blur-xl border border-white/10 rounded-[2.5rem] p-2 flex justify-around shadow-2xl z-50"><button onclick="showSection('home')" id="nav-home" class="flex flex-col items-center p-3 rounded-2xl nav-active transition-all"><span class="text-xl">๐</span><span class="text-[10px] font-bold">ุงูุฑุฆูุณูุฉ</span></button><button onclick="showSection('tasks')" id="nav-tasks" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all"><span class="text-xl">๐</span><span class="text-[10px] font-bold">ุงูููุงู</span></button><button onclick="showSection('store')" id="nav-store" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all"><span class="text-xl">๐ต</span><span class="text-[10px] font-bold">ุงูุณุญุจ</span></button></nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyD6Jdy-USR8Iy6qvFRGpVQY5qIjSxa-Fc0",
          authDomain: "salm-3521d.firebaseapp.com",
          projectId: "salm-3521d",
          storageBucket: "salm-3521d.appspot.com",
          messagingSenderId: "897813694871",
          appId: "1:897813694871:web:89c989960a8d620c4d1cd2"
        };

        try {
            const app = initializeApp(firebaseConfig );
            const auth = getAuth(app);
            const db = getFirestore(app);
            runApp(auth, db);
        } catch (error) {
            console.error("Initialization Error:", error);
            document.getElementById('loading-text').innerText = 'ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.';
        }

        function runApp(auth, db) {
            const AdController = window.Adsgram.init({ blockId: "int-22662" });
            const showInterstitialAd = () => { AdController.show().catch(e => console.log("Interstitial Ad failed", e)); };

            let currentUser = null;
            let userData = { balance: 0, lastOpenTime: 0, completedTasks: [], rewardedAdCount: 0, lastRewardedAdTime: 0 };
            let appSettings = { tasks: [], prizes: [] };
            
            const COOLDOWN = 10 * 60 * 1000;
            const REWARDED_AD_BONUS = 0.20;
            const REWARDED_AD_LIMIT = 5;
            const REWARDED_AD_COOLDOWN = 10 * 60 * 1000;

            async function syncRemoteData(dataToSync) { if (!currentUser) return; await setDoc(doc(db, "users", currentUser.uid), dataToSync, { merge: true }); }

            window.showSection = (name) => { showInterstitialAd(); /* ... */ };
            window.closeModal = () => { showInterstitialAd(); document.getElementById('prize-modal').classList.add('hidden'); };
            window.handleOpen = () => { showInterstitialAd(); /* ... */ };
            window.doTask = (id, bonus, url) => { showInterstitialAd(); /* ... */ };
            window.requestWithdraw = (price, name) => { showInterstitialAd(); /* ... */ };

            window.handleWatchAd = () => {
                showInterstitialAd();
                const adButton = document.getElementById('rewarded-ad-btn');
                adButton.disabled = true;

                AdController.show().then((result) => {
                    if (result.done) {
                        userData.balance += REWARDED_AD_BONUS;
                        userData.rewardedAdCount++;
                        if (userData.rewardedAdCount >= REWARDED_AD_LIMIT) {
                            userData.lastRewardedAdTime = Date.now();
                        }
                        syncRemoteData({ balance: userData.balance, rewardedAdCount: userData.rewardedAdCount, lastRewardedAdTime: userData.lastRewardedAdTime });
                        updateUI();
                        alert(`๐ ูุจุฑูู! ููุฏ ุฑุจุญุช ${REWARDED_AD_BONUS.toFixed(2)}$`);
                    } else {
                        alert("ูุฌุจ ูุดุงูุฏุฉ ุงูุฅุนูุงู ุจุงููุงูู ููุญุตูู ุนูู ุงูููุงูุฃุฉ.");
                    }
                }).catch((result) => {
                    alert("ุนุฐุฑูุงุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุฅุนูุงู. ุญุงูู ูุฑุฉ ุฃุฎุฑู.");
                }).finally(() => {
                    updateAdButtonState();
                });
            };

            function updateAdButtonState() {
                const adButton = document.getElementById('rewarded-ad-btn');
                const now = Date.now();
                const timeSinceLastCycle = now - userData.lastRewardedAdTime;

                if (userData.rewardedAdCount >= REWARDED_AD_LIMIT && timeSinceLastCycle < REWARDED_AD_COOLDOWN) {
                    const remaining = REWARDED_AD_COOLDOWN - timeSinceLastCycle;
                    const mins = Math.floor(remaining / 60000);
                    const secs = Math.floor((remaining % 60000) / 1000);
                    const timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                    adButton.disabled = true;
                    adButton.innerHTML = `<span>ุงูุชุธุฑ ${timeStr} ูููุดุงูุฏุฉ ูุฌุฏุฏุงู</span>`;
                } else {
                    if (userData.rewardedAdCount >= REWARDED_AD_LIMIT) {
                        userData.rewardedAdCount = 0;
                        syncRemoteData({ rewardedAdCount: 0 });
                    }
                    adButton.disabled = false;
                    const remainingViews = REWARDED_AD_LIMIT - userData.rewardedAdCount;
                    adButton.innerHTML = `<span class="text-xl">๐บ</span> <span>ุดุงูุฏ ุฅุนูุงู (${remainingViews}/${REWARDED_AD_LIMIT}) ูุงุญุตู ุนูู ${REWARDED_AD_BONUS.toFixed(2)}$</span>`;
                }
            }
            
            function updateUI() {
                document.getElementById('balance-display').innerText = `${(userData.balance || 0).toFixed(2)}$`;
                updateAdButtonState();
                // ... renderTasks, renderStore, checkTimer
            }

            async function initializeUserSession() {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        const userRef = doc(db, "users", user.uid);
                        const docSnap = await getDoc(userRef);

                        if (docSnap.exists()) {
                            const remoteData = docSnap.data();
                            userData = { ...userData, ...remoteData };
                        } else {
                            await syncRemoteData(userData);
                        }
                        
                        // ... ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ...
                        const settingsSnap = await getDoc(doc(db, "configs", "app-settings"));
                        if (settingsSnap.exists()) { appSettings = settingsSnap.data(); }
                        
                        updateUI();
                        document.getElementById('loading-screen').classList.add('hidden');
                        setInterval(checkTimer, 1000);
                        setInterval(updateAdButtonState, 1000); // ุชุญุฏูุซ ุฒุฑ ุงูุฅุนูุงู ูู ุซุงููุฉ
                    } else {
                        signInAnonymously(auth);
                    }
                });
            }
            
            // ุฑุจุท ุงูุฃุญุฏุงุซ
            document.getElementById('open-packet-btn').onclick = () => window.handleOpen();
            document.getElementById('main-action-btn').onclick = () => window.handleOpen();
            document.getElementById('rewarded-ad-btn').onclick = () => window.handleWatchAd();

            initializeUserSession();
        }
    </script>
</body>
</html>

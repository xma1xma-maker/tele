<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clicker Store Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --primary: #0098EA;
            --secondary: #f39c12;
            --surface: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --success: #00E096;
            --danger: #FF3B30;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a3a5a, #000);
            color: var(--text-main);
            margin: 0; min-height: 100vh;
            display: flex; flex-direction: column;
            padding-bottom: 95px;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* --- Header --- */
        .header {
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }
        .user-badge { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 35px; height: 35px; background: linear-gradient(45deg, var(--primary), #00d2ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
        .rank-info { display: flex; flex-direction: column; line-height: 1.2; }
        .lang-btn { background: transparent; border: 1px solid var(--border); color: #fff; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; }

        /* --- Score --- */
        .score-container { text-align: center; margin-top: 15px; }
        .score-val { font-size: 2.8rem; font-weight: 900; color: #fff; text-shadow: 0 0 15px rgba(0, 152, 234, 0.5); }
        .score-label { font-size: 0.9rem; color: #aaa; margin-top: -5px; }

        /* --- GAME AREA --- */
        .game-area {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            position: relative; margin: 20px 0;
        }
        .coin {
            width: 240px; height: 240px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe);
            border: 8px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(0, 152, 234, 0.4), inset 0 0 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.1s;
            position: relative; z-index: 5;
        }
        .coin:active { transform: scale(0.95); }
        .coin svg { width: 60%; fill: #fff; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }

        .float-num {
            position: absolute; color: #fff; font-weight: 900; font-size: 2rem;
            pointer-events: none; z-index: 100; text-shadow: 0 0 5px var(--primary);
            animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }

        /* Energy */
        .energy-container { width: 80%; margin: 10px auto; }
        .energy-info { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; color: #ddd; }
        .energy-bg { width: 100%; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #f39c12, #f1c40f); width: 100%; transition: width 0.2s; }

        /* --- Store --- */
        .section-title { padding: 0 20px; margin: 10px 0 5px 0; font-size: 1.1rem; color: #aaa; }
        .store-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            padding: 0 15px 20px 15px;
        }
        .store-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 15px; padding: 15px;
            text-align: center; cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .store-card:active { transform: scale(0.95); background: rgba(255,255,255,0.12); }
        .card-icon { font-size: 2rem; margin-bottom: 5px; }
        .card-title { font-weight: bold; font-size: 0.9rem; margin-bottom: 5px; }
        .card-price { color: var(--secondary); font-weight: bold; font-size: 0.8rem; background: rgba(243, 156, 18, 0.15); padding: 2px 8px; border-radius: 8px; }

        /* --- Nav --- */
        .nav-bar {
            position: fixed; bottom: 15px; left: 15px; right: 15px;
            background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid rgba(255,255,255,0.08);
            display: flex; justify-content: space-around;
            padding: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 500;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #888; font-size: 0.75rem; gap: 4px; padding: 5px 10px;
            border-radius: 15px; transition: 0.2s; width: 60px; cursor: pointer;
        }
        .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; transform: translateY(-5px); }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 900;
            opacity: 0; visibility: hidden; transition: 0.3s;
            backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: flex-end;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: #1a1a1a; width: 100%; max-width: 600px;
            border-radius: 30px 30px 0 0; padding: 25px;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto;
        }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-btn { background: #333; border: none; width: 30px; height: 30px; border-radius: 50%; color: #fff; cursor: pointer; }

        /* UI Elements */
        .inp { width: 100%; padding: 15px; background: #222; border: 1px solid #444; color: #fff; border-radius: 12px; margin-bottom: 15px; text-align: center; }
        .btn-main { width: 100%; padding: 16px; background: var(--primary); color: #fff; border: none; border-radius: 14px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-sec { width: 100%; padding: 12px; background: #333; color: #fff; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .list-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .countdown-box { font-size: 2rem; font-weight: 900; margin: 20px 0; font-variant-numeric: tabular-nums; }
    </style>
</head>
<body>

    <div class="header">
        <div class="user-badge">
            <button class="lang-btn" onclick="toggleLang()" id="lang-btn">ğŸ‡ºğŸ‡¸</button>
            <div class="rank-info" style="margin: 0 10px">
                <span class="rank-name" id="user-name">Guest</span>
                <span style="font-size:0.75rem; color:#888" id="user-id">ID: ...</span>
            </div>
        </div>
        <button class="btn-main" style="width:auto; margin:0; padding:5px 15px; font-size:0.8rem; background:linear-gradient(45deg, #f39c12, #d35400)" onclick="openBoostModal()" data-key="boost_btn">ğŸš€ ØªØ±Ù‚ÙŠØ©</button>
    </div>

    <div class="score-container">
        <div class="score-val" id="score">0</div>
        <div class="score-label" data-key="balance">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
    </div>

    <div class="game-area">
        <div class="coin" onpointerdown="handleTap(event)">
            <svg viewBox="0 0 24 24"><path d="M12 22L1.5 8 12 2l10.5 6L12 22zm0-2.5l8-10-8-5.5-8 5.5 8 10z"/></svg>
        </div>
    </div>

    <div class="energy-container">
        <div class="energy-info">
            <span data-key="energy">âš¡ Ø§Ù„Ø·Ø§Ù‚Ø©</span>
            <span id="energy-txt">500/500</span>
        </div>
        <div class="energy-bg"><div class="energy-fill" id="energy-bar"></div></div>
    </div>

    <h3 class="section-title" data-key="store_title">Ø§ØµØ±Ù Ù†Ù‚Ø§Ø·Ùƒ ğŸ‘‡</h3>
    <div class="store-grid">
        <div class="store-card" onclick="openOrderModal('insta', 'item_insta', 5000)">
            <div class="card-icon">ğŸ“¸</div>
            <div class="card-title" data-key="item_insta">Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…</div>
            <div class="card-price">5,000 P</div>
        </div>
        <div class="store-card" onclick="openOrderModal('tele', 'item_tele', 5000)">
            <div class="card-icon">âœˆï¸</div>
            <div class="card-title" data-key="item_tele">Ø£Ø¹Ø¶Ø§Ø¡ ØªÙ„ÙŠØ¬Ø±Ø§Ù…</div>
            <div class="card-price">5,000 P</div>
        </div>
        <div class="store-card" onclick="openOrderModal('tiktok', 'item_tiktok', 6000)">
            <div class="card-icon">ğŸµ</div>
            <div class="card-title" data-key="item_tiktok">ØªÙŠÙƒ ØªÙˆÙƒ</div>
            <div class="card-price">6,000 P</div>
        </div>
        <div class="store-card" onclick="openOrderModal('cash', 'item_cash', 50000)">
            <div class="card-icon">ğŸ’µ</div>
            <div class="card-title" data-key="item_cash">Ø±ØµÙŠØ¯ $5</div>
            <div class="card-price">50,000 P</div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active">
            <span style="font-size:1.4rem">ğŸ </span> <span data-key="nav_home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </div>
        <div class="nav-item" onclick="openTasksModal()">
            <span style="font-size:1.4rem">ğŸ“‹</span> <span data-key="nav_tasks">Ù…Ù‡Ø§Ù…</span>
        </div>
        <div class="nav-item" onclick="startQuiz()">
            <span style="font-size:1.4rem">ğŸ§ </span> <span data-key="nav_quiz">Ù…Ø³Ø§Ø¨Ù‚Ø©</span>
        </div>
        <div class="nav-item" onclick="openDailyModal()">
            <span style="font-size:1.4rem">ğŸ“…</span> <span data-key="nav_daily">ÙŠÙˆÙ…ÙŠ</span>
        </div>
    </div>

    <div class="modal-overlay" id="orderModal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="order-title" data-key="order_title">Ø·Ù„Ø¨</h3><button class="close-btn" onclick="closeModal('orderModal')">âœ•</button></div>
            <div style="text-align:center; margin-bottom:20px">
                <div style="font-size:3rem" id="order-icon">ğŸ“¦</div>
                <p style="color:#aaa" data-key="order_desc">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„ØªÙ†ÙÙŠØ°</p>
                <h3 style="color:var(--secondary)" id="order-price-lbl">0</h3>
            </div>
            <input type="text" class="inp" id="order-link" placeholder="Link / ID">
            <button class="btn-main" onclick="submitOrder()" data-key="confirm">ØªØ£ÙƒÙŠØ¯ âœ…</button>
        </div>
    </div>

    <div class="modal-overlay" id="boostModal">
        <div class="modal-content" style="text-align:center">
            <div class="modal-header"><h3 data-key="boost_title">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¶ØºØ·</h3><button class="close-btn" onclick="closeModal('boostModal')">âœ•</button></div>
            <div style="font-size:4rem; margin:10px 0">ğŸ‘†</div>
            <h3 data-key="boost_multitap">Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©</h3>
            <p style="color:#aaa; margin-bottom:20px" data-key="boost_desc">Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¶ØºØ·Ø©</p>
            
            <div class="list-item">
                <div data-key="level">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div style="font-weight:bold; color:var(--primary)" id="boost-lvl">1</div>
            </div>
            
            <button class="btn-main" onclick="buyBoost()" id="boost-btn">Upgrade</button>
        </div>
    </div>

    <div class="modal-overlay" id="tasks">
        <div class="modal-content">
            <div class="modal-header"><h3 data-key="nav_tasks">Ø§Ù„Ù…Ù‡Ø§Ù…</h3><button class="close-btn" onclick="closeModal('tasks')">âœ•</button></div>
            <div id="tasks-list"></div>
        </div>
    </div>

    <div class="modal-overlay" id="quiz">
        <div class="modal-content" style="text-align:center">
            <div class="modal-header"><h3 data-key="nav_quiz">Ù…Ø³Ø§Ø¨Ù‚Ø©</h3><button class="close-btn" onclick="closeModal('quiz')">âœ•</button></div>
            <h3 id="q-txt">?</h3>
            <div id="q-opts" style="margin-top:20px"></div>
        </div>
    </div>

    <div class="modal-overlay" id="daily">
        <div class="modal-content" style="text-align:center">
            <div class="modal-header"><h3 data-key="daily_title">ÙŠÙˆÙ…ÙŠ</h3><button class="close-btn" onclick="closeModal('daily')">âœ•</button></div>
            <div style="font-size:3rem">ğŸ</div>
            
            <div id="daily-ready" style="display:none">
                <p data-key="daily_msg">Ø§Ø³ØªÙ„Ù… Ù‡Ø¯ÙŠØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©!</p>
                <button class="btn-main" onclick="claimDaily()" data-key="daily_claim">Ø§Ø³ØªÙ„Ø§Ù… (+1000)</button>
            </div>
            
            <div id="daily-timer" style="display:none">
                <p data-key="daily_wait">Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¨Ø¹Ø¯:</p>
                <div class="countdown-box" id="timer-txt">00:00:00</div>
                <button class="btn-sec" onclick="closeModal('daily')" data-key="close">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // âš ï¸ Admin Settings
        const CONFIG = {
            adminUsername: "YOUR_USERNAME", // Put your username here without @
            maxEnergy: 1000
        };

        // --- Localization Data ---
        const LANG = {
            ar: {
                balance: "Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ", energy: "âš¡ Ø§Ù„Ø·Ø§Ù‚Ø©", store_title: "Ø§ØµØ±Ù Ù†Ù‚Ø§Ø·Ùƒ ğŸ‘‡",
                nav_home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", nav_tasks: "Ù…Ù‡Ø§Ù…", nav_quiz: "Ù…Ø³Ø§Ø¨Ù‚Ø©", nav_daily: "ÙŠÙˆÙ…ÙŠ",
                boost_btn: "ğŸš€ ØªØ±Ù‚ÙŠØ©", boost_title: "ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¶ØºØ·", boost_multitap: "Ø§Ù„Ù†Ù‚Ø±Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©",
                boost_desc: "Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¶ØºØ·Ø©", level: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ", upgrade: "ØªØ±Ù‚ÙŠØ© Ø¨Ù€",
                item_insta: "Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…", item_tele: "Ø£Ø¹Ø¶Ø§Ø¡ ØªÙ„ÙŠØ¬Ø±Ø§Ù…", item_tiktok: "ØªÙŠÙƒ ØªÙˆÙƒ", item_cash: "Ø±ØµÙŠØ¯ $5",
                order_title: "Ø·Ù„Ø¨", order_desc: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„ØªÙ†ÙÙŠØ°", confirm: "ØªØ£ÙƒÙŠØ¯ âœ…",
                daily_title: "ÙŠÙˆÙ…ÙŠ", daily_msg: "Ø§Ø³ØªÙ„Ù… Ù‡Ø¯ÙŠØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©!", daily_claim: "Ø§Ø³ØªÙ„Ø§Ù…", daily_wait: "Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¨Ø¹Ø¯:",
                close: "Ø¥ØºÙ„Ø§Ù‚", done: "ØªÙ…", do: "Ù†ÙØ°", correct: "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©", wrong: "Ø®Ø·Ø£",
                insufficient: "Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ©!", link_err: "Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­"
            },
            en: {
                balance: "Current Balance", energy: "âš¡ Energy", store_title: "Spend Points ğŸ‘‡",
                nav_home: "Home", nav_tasks: "Tasks", nav_quiz: "Quiz", nav_daily: "Daily",
                boost_btn: "ğŸš€ Boost", boost_title: "Click Boost", boost_multitap: "Multitap",
                boost_desc: "Increase points per tap", level: "Current Level", upgrade: "Upgrade for",
                item_insta: "Insta Followers", item_tele: "TG Members", item_tiktok: "TikTok", item_cash: "Cash $5",
                order_title: "Order", order_desc: "Enter Link to Process", confirm: "Confirm âœ…",
                daily_title: "Daily Reward", daily_msg: "Claim your daily reward!", daily_claim: "Claim", daily_wait: "Next reward in:",
                close: "Close", done: "Done", do: "Go", correct: "Correct!", wrong: "Wrong!",
                insufficient: "Insufficient Points!", link_err: "Invalid Link"
            }
        };

        // --- Data & State ---
        let state = {
            score: parseInt(localStorage.getItem('cs_score') || 0),
            energy: parseInt(localStorage.getItem('cs_energy') || 1000),
            lastDaily: parseInt(localStorage.getItem('cs_lastDaily') || 0),
            completedTasks: JSON.parse(localStorage.getItem('cs_tasks') || "[]"),
            multitap: parseInt(localStorage.getItem('cs_multitap') || 1),
            lang: localStorage.getItem('cs_lang') || 'ar'
        };

        let currentOrder = {};
        
        // Bilingual Content Arrays
        const TASKS = [
            {id:1, txt_ar:"Ø§Ø´ØªØ±Ùƒ Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©", txt_en:"Join Channel", r:500, url:"https://t.me/telegram"},
            {id:2, txt_ar:"ØªØ§Ø¨Ø¹Ù†Ø§ Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…", txt_en:"Follow Instagram", r:300, url:"https://instagram.com"}
        ];
        const QUIZ = [
            {q_ar:"Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ", q_en:"Capital of Egypt?", a_ar:["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","Ø§Ù„Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"], a_en:["Cairo","Alexandria"], c:0},
            {q_ar:"Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ", q_en:"Color of Sky?", a_ar:["Ø£Ø­Ù…Ø±","Ø£Ø²Ø±Ù‚"], a_en:["Red","Blue"], c:1}
        ];

        window.onload = () => {
            applyLang(state.lang);
            updateUI();
            if(tg.initDataUnsafe?.user) {
                document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
                document.getElementById('user-id').innerText = "ID: " + tg.initDataUnsafe.user.id;
            }
            // Energy Regen
            setInterval(() => {
                if(state.energy < CONFIG.maxEnergy) {
                    state.energy += state.multitap;
                    if(state.energy > CONFIG.maxEnergy) state.energy = CONFIG.maxEnergy;
                    updateEnergyUI();
                }
            }, 1000);
            
            setInterval(save, 5000);
        };

        function save() {
            localStorage.setItem('cs_score', state.score);
            localStorage.setItem('cs_energy', state.energy);
            localStorage.setItem('cs_lastDaily', state.lastDaily);
            localStorage.setItem('cs_tasks', JSON.stringify(state.completedTasks));
            localStorage.setItem('cs_multitap', state.multitap);
            localStorage.setItem('cs_lang', state.lang);
        }

        // --- Localization Logic ---
        function toggleLang() {
            state.lang = state.lang === 'ar' ? 'en' : 'ar';
            applyLang(state.lang);
            save();
        }

        function applyLang(l) {
            const data = LANG[l];
            document.body.dir = l === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = l === 'ar' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡®ğŸ‡¶';
            
            // Apply text to all elements with data-key
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(data[key]) el.innerText = data[key];
            });
        }

        function t(key) { return LANG[state.lang][key]; } // Helper to get string in JS

        // --- Clicker ---
        function handleTap(e) {
            if(state.energy >= 1) {
                state.energy--;
                state.score += state.multitap;
                document.getElementById('score').innerText = state.score.toLocaleString();
                updateEnergyUI();
                if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                showFloatNum(e.clientX, e.clientY, state.multitap);
            }
        }

        function showFloatNum(x, y, val) {
            const el = document.createElement('div');
            el.className = 'float-num';
            el.innerText = '+' + val;
            el.style.left = (x + (Math.random() * 40 - 20)) + 'px';
            el.style.top = (y - 20) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function updateEnergyUI() {
            document.getElementById('energy-txt').innerText = `${state.energy}/${CONFIG.maxEnergy}`;
            document.getElementById('energy-bar').style.width = (state.energy / CONFIG.maxEnergy * 100) + "%";
        }
        function updateUI() {
            document.getElementById('score').innerText = state.score.toLocaleString();
            updateEnergyUI();
        }

        // --- Boost ---
        function openBoostModal() {
            openModal('boostModal');
            document.getElementById('boost-lvl').innerText = state.multitap;
            const cost = 500 * Math.pow(2, state.multitap - 1);
            document.getElementById('boost-btn').innerText = `${t('upgrade')} ${cost.toLocaleString()}`;
            document.getElementById('boost-btn').onclick = () => buyBoost(cost);
        }

        function buyBoost(cost) {
            if(state.score >= cost) {
                state.score -= cost;
                state.multitap++;
                save();
                updateUI();
                tg.showAlert(`Upgraded to Level ${state.multitap}!`);
                openBoostModal();
            } else {
                tg.showAlert(t('insufficient'));
            }
        }

        // --- Store ---
        function openOrderModal(type, keyName, price) {
            // Translate the name based on the key passed
            const name = t(keyName);
            currentOrder = { type, name, price };
            document.getElementById('order-title').innerText = name;
            document.getElementById('order-price-lbl').innerText = price.toLocaleString();
            let icon = type==='insta'?'ğŸ“¸': type==='tele'?'âœˆï¸': type==='tiktok'?'ğŸµ':'ğŸ’µ';
            document.getElementById('order-icon').innerText = icon;
            openModal('orderModal');
        }

        function submitOrder() {
            const link = document.getElementById('order-link').value;
            if(!link || link.length < 3) return tg.showAlert(t('link_err'));
            if(state.score < currentOrder.price) return tg.showAlert(t('insufficient'));

            state.score -= currentOrder.price;
            save();
            updateUI();

            const user = tg.initDataUnsafe.user;
            const uname = user ? `@${user.username || 'NoUser'} (${user.id})` : "Guest";
            const msg = `ğŸ›’ NEW ORDER:\nğŸ‘¤: ${uname}\nğŸ“¦: ${currentOrder.name}\nğŸ”—: ${link}\nğŸ’°: ${currentOrder.price}`;

            if(CONFIG.adminUsername !== "YOUR_USERNAME") {
                tg.openTelegramLink(`https://t.me/${CONFIG.adminUsername}?text=${encodeURIComponent(msg)}`);
                closeModal('orderModal');
                document.getElementById('order-link').value = "";
            } else {
                tg.showAlert("Done (Please set Admin Username)");
            }
        }

        // --- Daily Reward ---
        let dailyTimerInt;
        function openDailyModal() {
            openModal('daily');
            checkDailyReward();
            if(dailyTimerInt) clearInterval(dailyTimerInt);
            dailyTimerInt = setInterval(checkDailyReward, 1000);
        }

        function checkDailyReward() {
            const now = Date.now();
            const diff = now - state.lastDaily;
            const cooldown = 86400000;
            const readyDiv = document.getElementById('daily-ready');
            const timerDiv = document.getElementById('daily-timer');

            if(diff >= cooldown) {
                readyDiv.style.display = 'block';
                timerDiv.style.display = 'none';
            } else {
                readyDiv.style.display = 'none';
                timerDiv.style.display = 'block';
                const remaining = cooldown - diff;
                const h = Math.floor(remaining / (1000 * 60 * 60));
                const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((remaining % (1000 * 60)) / 1000);
                document.getElementById('timer-txt').innerText = `${h < 10 ? '0'+h : h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            }
        }

        function claimDaily() {
            state.score += 1000;
            state.lastDaily = Date.now();
            save();
            updateUI();
            checkDailyReward();
            tg.showAlert("+1000!");
        }

        // --- Tasks & Quiz ---
        function openTasksModal() {
            openModal('tasks');
            const d = document.getElementById('tasks-list'); d.innerHTML = '';
            TASKS.forEach(task => {
                const done = state.completedTasks.includes(task.id);
                // Select text based on language
                const txt = state.lang === 'ar' ? task.txt_ar : task.txt_en;
                d.innerHTML += `<div class="list-item"><div><b>${txt}</b><br><small style="color:var(--success)">+${task.r}</small></div>
                ${done ? `<small>${t('done')}</small>` : `<button onclick="doTask(${task.id},'${task.url}',${task.r})" style="background:var(--primary);border:none;color:#fff;padding:5px 10px;border-radius:5px">${t('do')}</button>`}</div>`;
            });
        }
        function doTask(id, url, r) {
            window.open(url);
            setTimeout(() => { 
                state.score += r; state.completedTasks.push(id); save(); updateUI(); openTasksModal();
            }, 2000);
        }

        function startQuiz() {
            openModal('quiz');
            const q = QUIZ[Math.floor(Math.random()*QUIZ.length)];
            const qText = state.lang === 'ar' ? q.q_ar : q.q_en;
            const answers = state.lang === 'ar' ? q.a_ar : q.a_en;
            
            document.getElementById('q-txt').innerText = qText;
            const d = document.getElementById('q-opts'); d.innerHTML = '';
            answers.forEach((ans, i) => d.innerHTML += `<button class="btn-main" style="margin-top:5px;background:#333" onclick="ansQuiz(${i},${q.c})">${ans}</button>`);
        }
        function ansQuiz(s, c) {
            if(s===c) { 
                state.score+=100; tg.showAlert(t('correct') + " +100"); closeModal('quiz'); updateUI(); save(); 
            } else {
                tg.showAlert(t('wrong'));
            }
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { 
            document.getElementById(id).classList.remove('active');
            if(id === 'daily' && dailyTimerInt) clearInterval(dailyTimerInt);
        }

    </script>
</body>
</html>
